@using HybridPages.Client.State;
@using HybridPages.Shared.Enums;
@using HybridPages.Shared.Interfaces;
@using HybridPages.Shared.Models;
@using HybridPages.Shared.Helpers;
@inject PageService _pageService;

@if (_pageService.SelectedPost != null)
{
	<AuthorizeView Context="authContext">
		<Authorized>
			<section class="section-editor">
				<article>
					<input type="text" @bind-value="Title" @bind-value:event="oninput" />
					<input type="text" @bind-value="Content" @bind-value:event="oninput" />
					@if (_pageService.SelectedPost?.Id != _pageService.Page?.Posts?.First?.Value.Id)
					{
						<button @onclick="_pageService.MoveUp">Move Up</button>
					}
					@if (_pageService.SelectedPost?.Id != _pageService.Page?.Posts?.Last?.Value.Id)
					{
						<button @onclick="_pageService.MoveDown">Move Down</button>
					}
				</article>
			</section>
		</Authorized>
	</AuthorizeView>
}

@code {
	protected override async Task OnInitializedAsync()
	{
		_pageService.OnStateChange += StateHasChanged;
	}
	public string Title
	{
		get
		{
			return _pageService.SelectedPost?.Title ?? "Title";
		}
		set
		{
			if (_pageService.SelectedPost != null)
			{
				_pageService.SelectedPost.Title = value;
				_pageService.NotifyStateChanged();
			}
		}
	}
	public string Content
	{
		get
		{
			return _pageService.SelectedPost?.Content ?? "Content";
		}
		set
		{
			if (_pageService.SelectedPost != null)
			{
				_pageService.SelectedPost.Content = value;
				_pageService.NotifyStateChanged();
			}
		}
	}
}